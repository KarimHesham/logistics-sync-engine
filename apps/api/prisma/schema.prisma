generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Order {
  id               String     @id @default(uuid())
  orderId          String     @unique @map("order_id")
  customerId       String     @map("customer_id")
  status           String
  totalAmount      Int        @map("total_amount")
  addressLine1     String?    @map("address_line_1")
  addressLine2     String?    @map("address_line_2")
  city             String?
  state            String?
  postalCode       String?    @map("postal_code")
  country          String?
  shippingFeeCents Int        @map("shipping_fee_cents")
  lastEventTs      DateTime   @map("last_event_ts")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  deletedAt        DateTime?  @map("deleted_at")
  shipments        Shipment[]

  @@map("orders")
}

model Shipment {
  id             String    @id @default(uuid())
  orderOrderId   String    @map("order_order_id")
  courierStatus  String    @map("courier_status")
  trackingNumber String    @map("tracking_number")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  deletedAt      DateTime? @map("deleted_at")
  order          Order     @relation(fields: [orderOrderId], references: [orderId])

  @@map("shipments")
}

model EventInbox {
  id          String    @id @default(uuid())
  dedupeKey   String    @unique @map("dedupe_key")
  source      String
  orderId     String    @map("order_id")
  eventType   String    @map("event_type")
  eventTs     DateTime  @map("event_ts")
  payload     Json
  status      String
  processedAt DateTime? @map("processed_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  @@map("event_inbox")
}
